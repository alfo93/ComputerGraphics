<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Alfonso Esposito - Computer Graphics - UniBo Exam Project</title>
        <link rel="stylesheet" type="text/css" href="../doc/custom.css">
    </head>
    <body>
        <div class="row clearfix">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="text-align: center !important;">
                <h1>
                    Relazione - Esame di Computer Graphics - Alfonso Esposito matricola 1057171<br>
                </h1>
                <h1 style="text-align: center !important;">
                    Progetto Museo
                </h1>
            </div>
        </div>
        <div class="row clearfix">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <h2>
                    Introduzione
                </h2>
                <p>
                    Il seguente progetto sviluppato consiste nella realizzazione di un modello 3D di una stanza e vuole rappresentare l'esposizione di un paio di quadri e di un modellino su tavolo.<br>
                    Il modelli visibili nella scena sono stati realizzati con Blender, mentre il caricamento di questi ultimi e il loro posizionamento nella stanza è stato realizzato con WebGl.<br>
                    All'interno della seguente relazione sono contenuti i dettagli relativi allo sviluppo del progetto e le scelte effettuate.
                </p>
            </div>
        </div>
        <div class="row clearfix">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <h2>Descrizione della struttura del progetto</h2>
                <p>
                    Il progetto è stato sviluppato interamente utilizzando il linguaggio Javascript, integrato con la libreria di WebGl e le librerie fornite durante le lezioni del Corso di Computer Graphics.<br>
                    Come interfaccia grafica sono stati utilizzati fogli di stile integrati all'interno di una pagina HTML.<br>
                    All'interno della repository sono presenti i seguenti file:
                    <ul>
                        <li>
                            La cartella <b>doc</b> contiene il file relativo alla presente documentazione del progetto.
                        </li>
                        <li>
                            La cartella <b>project</b> contiene i file relativi alla realizzazione del progetto.<br>
                            In particolare, quest'ultima è organizzata nel seguente modo:
                            <ul>
                                <li>
                                    La cartella <b>img</b> contiene la foto utilizzata come background per il contesto 2D contente le informazioni testuali e il pad per l'interazione utente.<br>
                                    L'unica immagine presente è il disegno di un foglio a quadretti, utilizzato come sfondo per il contesto 2D.
                                </li>
                                <li>
                                    La cartella <b>objFiles</b> contiene i file relativi a tutti i modelli mesh utilizzati all'interno della scena.<br>
                                    Per ogni elemento è presente una cartella che rappresenta, con il nome, l'oggetto in questione, e contiene, oltre che al file <b>.obj</b>, che rappresenta la geometria dell'oggetto, anche il file <b>.mtl</b><br>
                                    che invece contiene le informazioni in merito alle texture e ai materiali applicati all'oggetto.
                                </li>
                                <li>
                                    La cartella <b>resources</b> contiene tutti i file javascript utilizzati per il caricamento e la gestione della scena.<br>
                                    Questa cartella al suo interno è stata organizzata in modo tale da suddividere i file in base alla loro funzione:
                                    <ul>
                                        <li>
                                            Le librerie sono state racchiuse nella directory <b>libraries</b>.
                                        </li>
                                        <li>
                                            I file scritti dall'autore sono presenti con il corrispettivo nome all'interno della directory <b>resources</b>.
                                        </li>
                                    </ul> 
                                </li>
                                <li>
                                    La cartella <b>style</b> contiene, invece, i fogli di stile utilizzati per la realizzazione dell'interfaccia grafica.
                                </li>
                                <li>
                                    Il file <b>index.html</b> è il file principale del progetto, che contiene la struttura HTML e il collegamento a tutti i file javascript e fogli di stile.
                                </li>
                            </ul>
                        </li>
                    </ul>
                </p>
            </div>
        </div>
        <div class="row clearfix">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <h2>Descrizione della scena, la directory objFiles</h2>
                <p>
                    La scena è stata realizzata con l'ausilio di Blender. In ogni directoy sono presenti, nei formati <b>.obj</b> e <b>.mtl</b>, i modelli mesh e le informazioni relative ai materiali e alle texture utilizzate:
                    <ul>
                        <li>
                            Due dipinti, posti uno di fronte l'altro, raffiguranti il bacio di klimt e la notte stellata di van gogh.<br>
                        </li>
                        <li>
                            Un tavolo, sul quale è posizionato un ring contenente un t-rex e la faccia di una scimmia, entrambi con guatoni da boxe, immortalati nell'atto del combattimento.<br>
                            Il tavolo, al quale è stato applicato una texture raffigurante legno d'ulivo, è presente nella directory <b>Stanza/Tavolo</b><br> 
                            Il ring, colorato di blu, è nella directory <b>Ring</b>;<br>
                            Il T-rex, colorato di verde, è nella directory <b>T-rex</b> mentre la scimmia, colorata di marrone, è nella directory <b>Suzanne</b>.
                        </li>
                        <li>
                            Il tavolo poggia su un pavimento al quale è stato applicato una texture raffigurante un parquet legno scuro. Il pavimento è presente nella sottodirectory <b>Stanza/Pavimento</b>.
                        </li>
                        <li>
                            Una finestra, che presenta un pannello che funge da vetro, al quale è stata applicata una trasparenza per permettere la visione di un paesaggio esterno.<br> 
                            Il paesaggio esterno è un pannello al quale è stata applicata una texture con la foto <b>landascape</b><br>
                            La finestra è presente nella directory <b>Stanza/Finestra</b>; <br> Il landascape è nella sottodirectory <b>Stanza/Finestra/Landascape</b>;<br>
                            La maniglia della finestra è nella sottodirectory <b>Stanza/Finestra/Maniglia</b>; <br> Il vetro è nella sottodirectory <b>Stanza/Finestra/Vetro</b>.
                        </li>
                        <li>
                            Delle lampade poste al di sopra di ogni quadro, al cui interno è presente una lampadina colorata di giallo, alla quale è stata applicata una trasparenza per rendere più verosimile l'idea di luce.<br>
                            Le lampade sono presenti nella sottodirectory <b>Lighter/Lampadario</b>. Le lampadine invece sono presenti nella sottodirectory <b>Lighter/Lampada</b>.
                        </li>
                        <li>
                            Una cornice, raffigurante l'immagine dell'autore del progetto, presente nella directory <b>Quadro</b>. La cornice, colorata di marrone, è nella sottodirectory <b>Quadro/Cornice</b>, mentre l'immagine è nella sottodirectory <b>Quadro/Tela</b>.
                        </li>
                        <li>
                            Infine il tutto è racchiuso all'interno di tre mura. Le mura sono presenti nella sottodirectory <b>Stanza/Mura</b>. 
                        </li>
                    </ul>
                </p>
            </div>
        </div>
        <div class="row clearfix">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <h2>Sviluppo della scena, la directory resources</h2>
                <div class="row clearfix">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <h3>main.js</h3>
                        <p>
                            <b>main.js</b> è file principale nel quale vengono inizializzate tutte le variabili globali, creato il contesto 3D e 2D e avviato il rendering.<br>
                            La funzione main, responsabile dell'avvio della scena, prevede la creazione di un oggetto Canvas.<br>
                            L'oggetto canvas viene utilizzato dall'oggetto Model per la creazione e la visualizzazione dei modelli mesh.<br>
                            Viene successivamente creato un oggetto Camera, che viene utilizzato dall'oggetto Model per la visualizzazione della scena.<br>
                            Infine viene chiamata la funzione drawModel() per la visualizzazione della scena. <br><br>
                            All'interno del file main vengono inizializzate le variabili utilizzate dai vari oggetti per la costruzione della scena.<br>
                            Sono inoltre presenti alcune funzioni utilizzate per la gestione di eventi.

                            <h4>Eventi da tastiera</h4>
                            La funzione <b>handleKeyboard</b> viene utilizzata per gestire l'evento di pressione del tasto sull tastiera associato ad un determianto movimento.<br>
                            Ogni qual volta l'utente preme uno dei tasti associati ad un determinato movimento, viene chiamata la funzione <b>handleKeyboard</b> che, in base al tasto premuto, applica un determinato movimento alla camera.<br>
                            La funzione di ogni tasto è riportata nel contesto 2D attraverso un libretto delle istruzioni, in modo da facilitare l'utente alla comprensione di questi ultimi
                            <h4>Eventi da mouse</h4>
                            Le funzioni <b>mouseDown</b>, <b>mouseUp</b>, <b>mouseMove</b> e <b>mouseWheel</b> vengono utilizzate per gestire gli eventi con l'utilizzo del mouse.<br> 
                            Vengono calcolate le coordinate del punto di pressione del mouse e utilizzate per calcolare la direzione di movimento della camera.<br>

                            <h4>Eventi touch</h4>
                            Per quanto riguarda la gestione degli eventi touch viene utilizzato lo stesso meccanismo di gestione degli eventi con mouse, con l'unica differenza che al canvas viene fatto il bind anche dell'evento touch.<br>
                            Le funzioni che si occupano di effettuare questi movimenti sono <b>touchStart</b>, <b>touchEnd</b> e <b>touchMove</b>. <br>
                            Ad ogni evento che chiama la funzione touchMove viene calcolato lo spostamento e applicato un determinato movimento alla camera.

                            <h4>Libretto delle istruzioni</h4>
                            All'interno della schermata principale del progetto viene mostrato all'utente un libretto delle istruzioni, come specificato in precedenza, con lo scopo di facilitare l'utente alla comprensione dei vari eventi.<br>
                            Il libretto è stato creato utilizzato un contesto 2D, al quale è stato applicato uno sfondo che rappresenta un foglio di carta a quadretti.
                            All'interno del libretto sono mostrati, sotto forma testuale, le istruzioni relative ai vari eventi associati ai vari tasti.<br>
                            Il testo è stato creato utilizzando la funzione <b>makeTextCanvas</b> che utilizza un array di istruzioni, sul quale viene fatto un ciclo ed ogni iterazione viene disegnata un'istruzione.

                            <h4>Camera pad</h4>
                            Viene inoltre fornito anche un piccolo pad caratterizzato da 4 pulsanti che permettono il movimento nelle quattro classiche direzioni: avanti, indietro, destra, sinistra all'interno della scena.<br>
                            Il pad viene disegnato dalla funzione <b>makeKeyCanvas</b>.
                            Essendo il pad un elemento del contesto 2D, i bottoni che lo caratterizzano sono stati disegnati su di esso utilizzando la funzione <b>drawButton</b>.<br>
                            In prima istanza viene creato un oggetto Path2D. A questo oggetto vengono assegnati determinati attributi. All'interno di un array vengono salvati tutti i bottoni che si vogliono creare.<br>
                            Viene poi iterato questo array utilizzando la funzione <b>drawAll</b> che chiama per ogni oggetto dell'array la funzione <b>drawButton</b>.<br>
                            Questa funzione permette di creare dei quadrati di dimensione fissa, applicando un determinato colore e un determinato testo.<br>

                            <h4>Pannello di controllo</h4>
                            In alto a destra, con la forma di un pannello di controllo, viene concessa inoltre la possibilità all'utente di modificare alcuni parametri per la gestione della scena. <br>
                            La creazione del pannello di controllo è stata effettuata utilizzando la librearia dat.gui fornita durante il corso. <br>
                            Attraverso la funzione <b>define_gui</b> avviene la creazione di questa graphic user inteface creando l'oggetto gui. <br>
                            Viene poi aggiunto all'oggetto una proprietà ed una serie di parametri che permettono poi la gestione della scena. <br>
                            Viene proposta la variazione di:
                            <ul>
                                <li>
                                    direzione della luce attraverso i parametri lx, ly, lz;
                                </li>
                                <li>
                                    movimento dell'oggetto lungo gli assi x e y, permettendo la rotazione dell'oggetto, utilizzando i parametri theta e phi
                                </li>
                                <li>
                                    <b>fovy</b> specifica l'angolo del campo visivo.
                                </li>
                                <li>
                                    trasparenza attraverso l'utilizzo di un checkbox. Di default il checkbox è attivato e dunque il vetro e le lampade risultano trasparenti. Al click è possibile disattivare tale proprietà.
                                </li>
                                <li>
                                    enable è un campo che permette di rendere attive e disponibili le funzioni del pannello di controllo. Se disattivato tutte le modifiche non avranno effetto sulla scena.
                                </li>
                            </ul>
                        </p>
                    </div>
                </div>
                <div class="row clearfix">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <h3>prepareCanvas.js</h3>
                        <h4>l'oggetto Canvas</h4>
                        <p>
                            Per la creazione del contesto 3D ho scelto di creare il <b>Canvas</b>, che rappresenta la finestra di rendering, come una classe. <br>
                            La costruzione del modello canvas come oggetto mi ha permesso di utilizzare tutti i vantaggi di una programmazione ad oggetti.<br>
                            La variabile canvas viene dichiarata nel file main.js, in scope globale, in modo da permettere poi ad ogni modello mesh di accedere a questa variabile. <br>
                            Il canvas viene inizializzato nella chiamata alla funzione <b>main</b>.<br>
                            Alla creazione dell'oggetto canvas, il costruttore crea in prima istanza il contesto webgl, e successivamente imposta il viewport, che specifica la trasformazione di x e y dalle coordinate del dispositivo alle coordinate della finestra. <br>
                            Viene inizializzata una lista di mesh che verrà successivamente riempita ogni qual volta viene istanziato un oggetto Model.<br>
        
                            Come ultimo passo viene creato il program chiamando la funzione della libreria di WebGl <b>webglUtils.createProgramInfo</b> che prende come parametri il contesto 3D e gli shader. <br>
                            <br>
                            Per gestire correttamente la trasformazione della scena in base al restringimento della finestra, viene chiamata nel main la funzione <b>resizeCanvasToDisplaySize</b><br>
                            Vengono memorizzate le coordinate width ed height della finestra e si confrontano con quelle del canvas. Se sono diverse, viene chiamata la funzione <b>resizeCanvasToDisplaySize</b> che imposta la dimensione del canvas alla dimensione della finestra. <br>
                        </p>
                    </div>
                </div>
                <div class="row clearfix">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <h3>Model.js</h3>
                        <h4>l'oggetto Model</h4>
                        <p>
                            Model rappresenta la classe degli oggetti mesh. <br>
                            La classe Model è costituita da una variabile <b>mesh</b> che contiene l'oggetto mesh. <br>
                            
                        </p>
                    </div>
                </div>
                <div class="row clearfix">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <h3>camera.js</h3>
                        <h4>l'oggetto Camera</h4>
                        <p>
                            Come per il canvas e per il modello, anche la camera è stata gestita con l'utilizzo di una classe.<br>
                            La variabile camera viene dichiarata in uno scope globale così da permettere ad ogni oggetto di accedere a questa variabile. <br>
                            L'oggetto della classe camera viene istanziato successivamente alla chiamata della funzione <b>main</b>, al quale vengono passati come parametri la posizione, il target ed up.<br>
                            Il costruttore della classe si occupa di inizializzare i parametri dell'oggetto position, forward, right ed up. <br>
                            La position è la posizione della camera, mentre forward e right sono gli assi che definiscono la direzione della camera. <br>
                            L'up è l'asse verticale della camera. <br>
                            Position viene inizializzato con il parametro <b>position</b> passato all'istanziazione dell'oggetto. <br>
                            Forward viene calcolata utilizzato la libreria m4 e applicando una normalizzazione alla sottrazione dei vettori target e position. <br>
                            Right, analogamente, viene calcolata con la libreria m4 e applicando una normalizzazione al prodotto tra vettori right e forward.<br><br>
                            All'interno della classe sono poi disponibili tutte le funzioni che permettono di modificare la posizione della camera e il suo orientamento <br>
                            Le funzioni sono:
                            <ul>
                                <li>
                                    tilt: Permette di ruotare la telecamera verso l'alto o verso il basso.
                                </li>
                                <li>
                                    pan: Permette di ruotare la telecamera verso destra o verso sinistra.
                                </li>
                                <li>
                                    cant: Inclina una telecamera lateralmente mantenendone la posizione e direzione di visualizzazione.
                                </li>
                                <li>
                                    truch: Permette di spostare la telecamera lateralmente senza modificare la direzione della visuale
                                </li>
                                <li>
                                    pedestal: Alza o abbassa la telecamera sul suo asse verticale.
                                </li>
                                <li>
                                    dolly: permette di allontanarsi o avvicinarsi rispetto al punto in cui si sta guardando
                                </li>
                                <li>
                                    align: permette il riallineamento della telecamera
                                </li>
                                <li>
                                    getViewMatrix: restituisce la viewMatrix
                                </li>
                                <li>
                                    getOriginalPosition: restituisce la posizione predefinita inizialmente della telemcamera
                                </li>
                                <li>
                                    getPosition: restituisce la posizione della telecamera
                                </li>
                            </ul>
                            
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
